<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- <script type = "text/javascript" src = "/sample.js"></script> -->
  </head>
  <body>
    <div style="height: 300px" id="Apex_Pie_chart"></div>
    <script>
      async function getApiData_pie1() {
        // return([44, 55, 13, 43, 22]);
        try {
          const response = await fetch("Latest/api.json");
          const data = await response.json();
          var values = [];
          var labels = [];
          for (var key in data) {
            // console.log(key)
            if (data.hasOwnProperty(key)) {
              values.push(parseInt(data[key]));
              labels.push(key);
            }
          }
          return [values, labels];
        } catch (error) {
          console.error("Error fetching data:", error);
          throw error;
        }
      }

      console.log(getApiData_pie1());
      function plotApexPie() {
        (async () => {
          try {
            const apiData = await getApiData_pie1();
            console.log(apiData);
            console.log("this working");
            values = apiData[0];
            labels = apiData[1];
            var options = {
              series: values,
              chart: {
                width: 900,
                height:300,
                type: "pie",
              },
              labels: labels,
              responsive: [
                {
                  breakpoint: 480,
                  options: {
                    chart: {
                      width: 200,
                    },
                    legend: {
                      position: "bottom",
                    },
                  },
                },
              ],
            };

            var chart = new ApexCharts(
              document.querySelector("#Apex_Pie_chart"),
              options
            );
            chart.render();
          } catch (error) {
            // Handle error if needed
          }
        })();
      }
      plotApexPie();
    </script>

    <div style="height: 300px"><canvas id="myChart"></canvas></div>
    <script>
      //   const ctx = document.getElementById("myChart");

      var data = [
        {
          data: [10, 20, 30, 40, 23],
          labels: ["Red", "Orange", "Yellow", "Green", "Blue"],
          backgroundColor: ["#4b77a9", "#5f255f", "#d21243", "#B27200"],
          borderColor: "#fff",
        },
      ];

      var options1 = {
        tooltips: {
          enabled: false,
        },
        responsive: false,
        plugins: {
          datalabels: {
            anchor: "end",
            align: "end",
            labels: {
              value: {
                color: "blue",
              },
            },
            formatter: (value, ctx) => {
              let sum = 0;
              let dataArr = ctx.chart.data.datasets[0].data;
              dataArr.map((data) => {
                sum += data;
              });
              let percentage = ((value * 100) / sum).toFixed(2) + "%";
              return percentage;
            },
            color: "#fff",
          },
        },
      };

      var ctx = document.getElementById("myChart").getContext("2d");
      var myChart = new Chart(ctx, {
        type: "pie",
        data: {
          datasets: data,
        },
        options: options1,
      });

      //   new Chart(ctx, config1);
    </script>
    <div id="APIDiv"></div>
    <script>
      getAPIData();
      function getAPIData() {
        fetch("Latest/api.json")
          .then((response) => {
            return response.json();
          })
          .then((data) => {
            console.log(data);
            processDataAndPlot_Pie(data, "APIDiv");
          })
          .catch((err) => {
            console.log("error", err);
          });
      }
      // Step 4: Wrap the bottom code in a function
      function processDataAndPlot_Pie(x, div) {
        console.log(x);
        // Convert the data into the desired format
        var values = [];
        var labels = [];
        for (var key in x) {
          if (x.hasOwnProperty(key)) {
            values.push(parseInt(x[key])); // Convert string to integer
            labels.push(key);
          }
        }
        var data = [
          {
            values: values,
            labels: labels,
            type: "pie",
          },
        ];
        var layout = {
          height: 400,
          width: 500,
        };
        Plotly.newPlot(div, data, layout);
      }
    </script>

    <!--
    <div id="UI_test_Div"></div>
    <script>
        getUI_test_Data()
        function getUI_test_Data(){
            fetch("Latest/ui.json").then(response => {
                return response.json();
            }).then(data => {
                console.log(data);
                processDataAndPlot_Pie(data["test"],"UI_test_Div");
            }).catch(err => {
                console.log("error", err);
            });
        }
    </script>
    <div id="UI_event_Div"></div>
    <script>
        getUI_test_Data()
        function getUI_test_Data(){
            fetch("Latest/ui.json").then(response => {
                return response.json();
            }).then(data => {
                console.log(data);
                processDataAndPlot_Pie(data["event"],"UI_event_Div");
            }).catch(err => {
                console.log("error", err);
            });
        }
    </script>
    -->
  </body>
</html>
